<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Libros — Mi Sitio</title>
  <meta name="description" content="Página de Libros — muestra todos tus títulos y permite añadir nuevos (localmente)." />
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header class="nav">
    <div class="wrap" id="mainNav"></div>
  </header>

  <main class="container">
    <h1>Libros</h1>

    <div class="card" style="margin-bottom:12px">
      <h3>Añadir libro</h3>
      <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px">
        <input id="bookTitle" placeholder="Título" style="flex:2;padding:8px;border-radius:8px;border:1px solid #e6eef8">
        <input id="bookSubtitle" placeholder="Subtítulo" style="flex:2;padding:8px;border-radius:8px;border:1px solid #e6eef8">
        <input id="bookCover" placeholder="URL imagen (opcional)" style="flex:1;padding:8px;border-radius:8px;border:1px solid #e6eef8">
        <button id="addBookBtn" class="btn btn-primary">Añadir</button>
      </div>
      <p class="note" style="margin-top:8px">Los libros se guardan en tu navegador (localStorage). Para publicar en conjunto a tu web, exporta o sube los metadatos al repo.</p>
    </div>

    <div style="display:flex;gap:12px;align-items:center;margin-bottom:12px">
      <input id="searchBook" placeholder="Buscar título..." style="padding:8px;border-radius:8px;border:1px solid #e6eef8;flex:1">
      <button id="clearBooks" class="btn" style="background:#fff;color:var(--text);border:1px solid #e6eef8">Limpiar</button>
    </div>

    <div id="booksGrid" class="grid"></div>

    <div id="bookDetail" class="card hidden" style="margin-top:12px"></div>

    <footer class="footer">© 2025 [Tu Nombre]</footer>
  </main>

  <script>
    (function buildNav(){
      const navWrap = document.getElementById('mainNav');
      const pages = [
        { file: 'index.html', label: 'Inicio' },
        { file: 'libros.html', label: 'Libros' },
        { file: 'reviews.html', label: 'Reseñas' },
        { file: 'about.html', label: 'Sobre mí' }
      ];
      const current = (location.pathname.split('/').pop() || 'index.html').toLowerCase();
      const left = document.createElement('div'); left.innerHTML = '<strong>Mi Sitio</strong>';
      const right = document.createElement('nav');
      pages.forEach(p => { if (p.file === current) return; const a = document.createElement('a'); a.href = p.file; a.textContent = p.label; a.style.marginLeft = '12px'; right.appendChild(a); });
      navWrap.appendChild(left); navWrap.appendChild(right);
    })();

    const KEY = 'mis_libros_v1';
    const DEFAULT = [ {id:1,title:'Perfecto — Reescritura',subtitle:'Capítulo 4 reescrito',cover:'cover.svg',amazon:'AMAZON_LINK_AQUI'} ];
    function load(){ try{ const raw = localStorage.getItem(KEY); return raw?JSON.parse(raw):DEFAULT.slice(); }catch(e){ return DEFAULT.slice(); } }
    function save(list){ localStorage.setItem(KEY, JSON.stringify(list)); }

    function renderBooks(list){
      const grid = document.getElementById('booksGrid');
      grid.innerHTML = '';
      if(list.length===0){ grid.innerHTML = '<div class="card">No hay libros.</div>'; return; }
      list.forEach((b, idx) => {
        const div = document.createElement('div'); div.className = 'card';
        div.innerHTML = `
          <div style="display:flex;gap:12px;align-items:center">
            <div style="width:80px;height:110px;background:#f2f4f7;border-radius:6px;overflow:hidden">
              <img src="${b.cover || 'cover.svg'}" style="width:100%;height:100%;object-fit:cover" alt="${escapeHtml(b.title)}">
            </div>
            <div style="flex:1">
              <h3>${escapeHtml(b.title)}</h3>
              <div class="meta">${escapeHtml(b.subtitle || '')}</div>
              <div style="margin-top:8px;display:flex;gap:8px">
                <button class="btn viewBook" data-idx="${idx}" style="background:#fff;color:var(--text);border:1px solid #e6eef8">Ver</button>
                <button class="btn" data-del="${b.id}" style="background:#fff;border:1px solid #f5c6c6;color:#a00">Eliminar</button>
              </div>
            </div>
          </div>`;
        grid.appendChild(div);
      });
      // handlers
      grid.querySelectorAll('.viewBook').forEach(b => b.addEventListener('click', e => showDetail(Number(e.currentTarget.dataset.idx))));
      grid.querySelectorAll('button[data-del]').forEach(b => b.addEventListener('click', e => { if (confirm('Eliminar libro?')) removeBook(Number(e.currentTarget.dataset.del)); }));
    }

    function escapeHtml(s){ if(!s) return ''; return s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

    function addBook(){
      const title = document.getElementById('bookTitle').value.trim();
      if(!title){ alert('Título requerido'); return; }
      const subtitle = document.getElementById('bookSubtitle').value.trim();
      const cover = document.getElementById('bookCover').value.trim();
      const list = load();
      const id = Date.now();
      list.unshift({ id, title, subtitle, cover, amazon: 'AMAZON_LINK_AQUI' });
      save(list);
      renderBooks(list);
      document.getElementById('bookTitle').value = ''; document.getElementById('bookSubtitle').value = ''; document.getElementById('bookCover').value = '';
    }

    function removeBook(id){
      let list = load(); list = list.filter(x => x.id !== id); save(list); renderBooks(list); document.getElementById('bookDetail').classList.add('hidden');
    }

    function showDetail(idx){
      const list = load(); const b = list[idx]; if(!b) return;
      const detail = document.getElementById('bookDetail'); detail.classList.remove('hidden');
      detail.innerHTML = `
        <div style="display:flex;gap:12px">
          <div style="width:120px;height:170px;overflow:hidden;border-radius:6px">
            <img src="${b.cover || 'cover.svg'}" style="width:100%;height:100%;object-fit:cover" alt="">
          </div>
          <div style="flex:1">
            <h2>${escapeHtml(b.title)}</h2>
            <div class="meta">${escapeHtml(b.subtitle || '')}</div>
            <div style="margin-top:12px">
              <a class="btn btn-primary" href="${b.amazon || '#'}" target="_blank">Comprar / Ficha</a>
              <button id="prevBook" class="btn" style="background:#fff;border:1px solid #e6eef8;margin-left:8px">‹ Anterior</button>
              <button id="nextBook" class="btn" style="background:#fff;border:1px solid #e6eef8;margin-left:6px">Siguiente ›</button>
            </div>
          </div>
        </div>`;
      document.getElementById('prevBook').addEventListener('click', ()=> { if(idx>0) showDetail(idx-1); });
      document.getElementById('nextBook').addEventListener('click', ()=> { const l = load(); if(idx < l.length-1) showDetail(idx+1); });
    }

    // search / clear
    document.getElementById('addBookBtn').addEventListener('click', addBook);
    document.getElementById('searchBook').addEventListener('input', ()=> {
      const q = document.getElementById('searchBook').value.trim().toLowerCase();
      const list = load().filter(x => (x.title + ' ' + (x.subtitle || '')).toLowerCase().includes(q));
      renderBooks(list);
    });
    document.getElementById('clearBooks').addEventListener('click', ()=> { document.getElementById('searchBook').value = ''; renderBooks(load()); });

    // initial render
    renderBooks(load());
  </script>
</body>
</html>
